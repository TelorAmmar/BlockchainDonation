<!doctype html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style type="text/tailwindcss">
        body {
            @apply text-[#1E1E1E] bg-[#F8F9FA];
        }
    </style>
</head>

<body>
    <!-- HEADER -->
    <div class="h-[139px] flex items-center justify-between px-20">
        <!-- LOGO -->
        <a href="/">
            <svg width="60" height="60" viewBox="0 0 44 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M23.6436 2.4659C25.8258 0.894708 28.3571 0.109111 31.2159 0.109111C32.787 0.109111 34.511 0.523732 36.3877 1.39662C38.2644 2.24768 39.7483 3.2515 40.8394 4.40807C43.0871 7.20131 44.0255 10.4528 43.6981 14.1626C43.349 17.8723 42.1269 20.7747 40.0102 22.826L23.4472 39.389C23.0325 39.8036 22.5088 40 21.8978 40C21.2868 40 20.7849 39.8036 20.3702 39.389C20.1685 39.1903 20.01 38.952 19.9049 38.6891C19.7997 38.4263 19.7501 38.1444 19.7592 37.8614C19.7592 37.2504 19.9556 36.7267 20.3702 36.3121L30.3866 26.2957C30.9322 25.8156 30.9322 25.3137 30.3866 24.7681C29.8411 24.2226 29.3391 24.2226 28.8591 24.7681L18.8427 34.7845C18.6407 34.9879 18.3987 35.1473 18.1321 35.2525C17.8654 35.3576 17.5798 35.4063 17.2933 35.3955C16.6823 35.3955 16.1804 35.1991 15.7658 34.7845C15.564 34.5858 15.4056 34.3476 15.3004 34.0847C15.1953 33.8218 15.1457 33.54 15.1548 33.257C15.1548 32.6459 15.3512 32.1222 15.7658 31.7076L25.7821 21.6912C26.3713 21.1457 26.3713 20.6001 25.7821 20.0546C25.2802 19.509 24.8001 19.509 24.2546 20.0546L14.2382 30.18C14.034 30.3803 13.7916 30.5376 13.5255 30.6426C13.2593 30.7475 12.9748 30.798 12.6888 30.7911C12.0778 30.7911 11.5541 30.5947 11.0958 30.18C10.6594 29.7654 10.4412 29.2635 10.4412 28.6525C10.4412 28.0415 10.6812 27.4959 11.1613 27.0158L21.1995 16.9776C21.745 16.4321 21.745 15.9302 21.1995 15.4501C20.6539 14.97 20.1302 14.97 19.6501 15.4501L9.52464 25.5101C9.04455 25.9465 8.54264 26.1866 7.99709 26.1866C7.38607 26.1866 6.86234 25.9684 6.46954 25.5101C6.05492 25.0737 5.8367 24.5499 5.8367 23.9389C5.8367 23.3279 6.05492 22.826 6.46954 22.4113C13.1471 15.6901 17.2715 11.6312 18.8427 10.1255L26.6114 17.8069C27.4624 18.6143 28.4444 19.0289 29.6447 19.0289C31.1722 19.0289 32.3724 18.4179 33.2671 17.1959C33.8782 16.3011 34.0964 15.3191 33.9218 14.228C33.7472 13.1369 33.289 12.2204 32.547 11.4566L23.6436 2.4659ZM28.1389 16.2793L18.8427 6.96127L3.39261 22.4113C1.55955 20.5565 0.512091 17.7196 0.272047 13.8571C0.0320038 10.0164 1.07947 6.67758 3.39261 3.88434C5.98945 1.30933 9.08819 0 12.6888 0C16.3113 0 19.3882 1.30933 21.8978 3.88434L31.2159 13.2024C31.6305 13.617 31.8269 14.1189 31.8269 14.73C31.8269 15.341 31.6305 15.8647 31.2159 16.2793C30.8012 16.6721 30.2993 16.8903 29.6447 16.8903C29.0555 16.8903 28.5536 16.6721 28.1389 16.2793Z"
                    fill="#1F7D53" />
            </svg>
        </a>

        <!-- NAVIGATION -->
        <div class="flex justify-between items-center gap-x-[97px]">
            <div class="flex justify-between gap-x-[21px]">
                <a href="/" class="font-bold text-[#196442]">Beranda</a>
                <a href="donation.html">Donasi</a>
                <a href="#">Tentang Kami</a>
            </div>

            <div id="auth-buttons" class="flex justify-between gap-x-[21px] items-center">
                <a href="login" id="login-button">Masuk</a>
                <a href="register" id="register-button" class="bg-[#1F7D53] text-white rounded-xl px-5 py-3">Daftar</a>
            </div>
        </div>
    </div>

    <div class="px-20 py-14 space-y-10">
        <h1 class="font-bold text-5xl">Detail Donasi</h1>
        
        <div class="grid grid-cols-12 gap-10">
            <div class="col-span-8 bg-white rounded-xl p-8 space-y-5">
                <div id="detail-section" class="space-y-8"> 
                    <!-- Konten campaign -->
                    <img id="campaign-image" src="./assets/images/donation-bg.png" alt="Campaign Image">

                    <h3 class="text-2xl font-bold" id="campaign-title">Loading...</h3>

                    <div class="flex gap-x-5 items-center">
                        <h3 class="text-xl font-bold text-[#1F7D53]" id="collected-amount">Rp. -</h3>
                        <p class="text-[#8E98A8]">Terkumpul dari</p>
                        <h3 class="text-xl font-bold" id="target-amount">Rp. -</h3>
                    </div>

                    <div class="relative w-full rounded-full h-3 bg-[#E9F2EE]">
                        <div id="progress-bar" class="absolute rounded-full inset-0 h-3 bg-[#1F7D53]" style="width: 0%"></div>
                    </div>


                    <div class="flex gap-x-5 items-center">
                        <!-- <img src="./assets/images/partner-1.png" class="h-12 object-contain"> -->
                        <div class="flex gap-x-2 items-center">
                            <p id="campaign-user-name" class="text-xl font-semibold"></p>
                            <img src="./assets/vectors/verified.png" class="size-5 object-contain">
                        </div>
                    </div>

                    <p class="text-[#8E98A8] whitespace-pre-line" id="campaign-description">Loading...</p>
                </div>
                
                <div id="donatur-section" style="display:none;"> 
                    <!-- Konten donatur -->
                    <div class="space-y-1">
                        <button id="btn-prev" class="block text-center rounded-xl text-white py-2 px-3 bg-[#1F7D53] font-bold">Kembali</button>
                        <h3 class="text-2xl font-bold">Info Donatur</h3>
                        <p><a href="/login" class="text-[#1F7D53] underline">Masuk akun</a> atau lengkapi data di bawah ini</p>
                    </div>

                    <div class="space-y-2">
                        <p>Nama Lengkap <span class="text-red-700">*</span></p>
                        <input type="text" class="w-full rounded-xl border border-[#8E98A880] py-2 px-3" placeholder="Nama Lengkap">
                    </div>
                    <div class="space-y-2">
                        <p>No. Whatsapp <span class="text-red-700">*</span></p>
                        <input type="text" class="w-full rounded-xl border border-[#8E98A880] py-2 px-3" placeholder="0812345678910">
                    </div>
                    <div class="space-y-2">
                        <p>Email</p>
                        <input type="text" class="w-full rounded-xl border border-[#8E98A880] py-2 px-3" placeholder="example@gmail.com">
                    </div>
                    <div class="space-y-2">
                        <p>Pesan atau Komentar</p>
                        <textarea class="w-full rounded-xl border border-[#8E98A880] py-2 px-3" rows="3"></textarea>
                    </div>
                    <div class="flex justify-between items-center">
                        <p>Sembunyikan Nama Saya</p>
                        <div class="h-8 w-14 bg-[#1F7D53] rounded-full relative">
                            <div class="absolute right-0 top-0 flex items-center justify-end h-full pr-1">
                                <div class="bg-white rounded-full size-6"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-span-4 bg-white rounded-xl p-8 space-y-5 h-min">
                <h3 class="text-2xl font-bold">Kirim Donasi</h3>

                <div class="space-y-5">
                    <div class="space-y-2">
                        <p>Nominal</p>
                        <input
                            id="nominal-input"
                            type="text"
                            min="10000"
                            class="text-xl font-bold rounded-xl w-full border border-[#8E98A880] p-3"
                            value="Rp 30.000"
                        />
                    </div>

                    <div class="space-y-2">
                        <p>Pilih Nominal</p>
                        <div class="grid grid-cols-2 gap-3" id="nominal-buttons">
                            <button class="rounded-xl text-white py-2 bg-[#1F7D53] font-bold" data-value="30000">Rp 30.000</button>
                            <button class="rounded-xl py-2 font-bold border border-[#8E98A880]" data-value="50000">Rp 50.000</button>
                            <button class="rounded-xl py-2 font-bold border border-[#8E98A880]" data-value="75000">Rp 75.000</button>
                            <button class="rounded-xl py-2 font-bold border border-[#8E98A880]" data-value="100000">Rp 100.000</button>
                            <button class="rounded-xl py-2 font-bold border border-[#8E98A880]" data-value="200000">Rp 200.000</button>
                            <button class="rounded-xl py-2 font-bold border border-[#8E98A880]" data-value="500000">Rp 500.000</button>
                        </div>
                        <p class="text-[#8E98A8]">Minimum donasi Rp 10.000</p>
                    </div>

                </div>
                <button id="btn-next" class="block text-center rounded-xl text-white py-2 bg-[#1F7D53] font-bold w-full">Selanjutnya</button>
                <button id="btn-donate" class="block text-center rounded-xl text-white py-2 bg-[#1F7D53] font-bold w-full" style="display:none;">Donasi</button>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <div class="bg-[#0B2C1D] px-20 py-14 space-y-16 text-white">
        <div class="flex justify-between">
            <div class="space-y-5">
                <h1 class="font-bold text-5xl text-[#1F7D53]">
                    Logo
                </h1>
                <p>Subscribe untuk mendapatkan info terbaru kami</p>
                <div class="rounded-full border border-white p-3 flex justify-between">
                    <input type="text" placeholder="Masukkan Email" class="flex-1">
                    <div class="size-7 flex items-center justify-center rounded-full bg-[#1F7D53]">
                        <img src="./assets/icons/arrow-right.png">
                    </div>
                </div>
            </div>

            <div class="gap-y-3 flex flex-col">
                <p>Dukungan</p>
                <a href="#" class="text-[#8E98A8]">FAQ & Privacy Policy</a>
                <a href="#" class="text-[#8E98A8]">Tentang</a>
                <a href="#" class="text-[#8E98A8]">Hubungi Kami</a>
                <a href="#" class="text-[#8E98A8]">Partner Kami</a>
            </div>
        </div>
        <p class="text-center">© 2025 Blockchain Donation Inc. Copyright and rights reserved</p>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');

        fetch(`/api/campaigns/${id}`)
        .then(res => res.json())
        .then(data => {
            document.getElementById("campaign-title").textContent = data.title;
            document.getElementById("collected-amount").textContent = `Rp. ${data.collectedAmount.toLocaleString()}`;
            document.getElementById("target-amount").textContent = `Rp. ${data.targetAmount.toLocaleString()}`;
            document.getElementById("campaign-description").textContent = data.description;
            document.getElementById("campaign-user-name").textContent = data.user.name;

            if (data.imageUrl) {
                document.getElementById("campaign-image").src = data.imageUrl;
            }

            const progress = Math.min(100, (data.collectedAmount / data.targetAmount) * 100);
            document.getElementById("progress-bar").style.width = `${progress}%`;
        })
        .catch(err => {
            alert("Gagal memuat data kampanye");
            console.error(err);
        });

        const token = localStorage.getItem("token");

            const loginBtn = document.getElementById("login-button");
            const registerBtn = document.getElementById("register-button");
            const authContainer = document.getElementById("auth-buttons");

            if (token) {
                authContainer.innerHTML = `
                    <div id="auth-buttons" class="flex justify-between gap-x-[21px] items-center">
                        <button id="logout-button" class="bg-red-600 text-white px-4 py-2 rounded-xl">Keluar</button>
                        <a href="dashboard" id="dashboard-button" class="bg-[#1F7D53] text-white rounded-xl px-5 py-3">Dashboard</a>
                    </div>
                `;

                document.getElementById("logout-button").addEventListener("click", () => {
                localStorage.removeItem("token");
                window.location.reload();
                });
            }

        const nominalInput = document.getElementById('nominal-input');
        const nominalButtons = document.querySelectorAll('#nominal-buttons button');

        nominalButtons.forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                // Set value input sesuai tombol
                nominalInput.value = this.dataset.value;
                // Update style tombol
                nominalButtons.forEach(b => b.classList.remove('bg-[#1F7D53]', 'text-white'));
                nominalButtons.forEach(b => b.classList.add('border', 'border-[#8E98A880]'));
                this.classList.add('bg-[#1F7D53]', 'text-white');
                this.classList.remove('border', 'border-[#8E98A880]');
            });
        });

        // Jika user mengetik manual, hilangkan highlight tombol
        nominalInput.addEventListener('input', function() {
            nominalButtons.forEach(b => b.classList.remove('bg-[#1F7D53]', 'text-white'));
            nominalButtons.forEach(b => b.classList.add('border', 'border-[#8E98A880]'));
        });

        // Fungsi format angka ke Rupiah
        function formatRupiah(angka) {
            angka = angka.replace(/[^0-9]/g, '');
            if (!angka) return '';
            return 'Rp ' + parseInt(angka, 10).toLocaleString('id-ID');
        }

        // Saat tombol diklik, input terisi format Rupiah
        nominalButtons.forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                nominalInput.value = formatRupiah(this.dataset.value);
                
                nominalButtons.forEach(b => b.classList.remove('bg-[#1F7D53]', 'text-white'));
                nominalButtons.forEach(b => b.classList.add('border', 'border-[#8E98A880]'));
                this.classList.add('bg-[#1F7D53]', 'text-white');
                this.classList.remove('border', 'border-[#8E98A880]');
            });
        });

        // Format ke Rupiah
        nominalInput.addEventListener('input', function() {
            this.value = formatRupiah(this.value);
            nominalButtons.forEach(b => b.classList.remove('bg-[#1F7D53]', 'text-white'));
            nominalButtons.forEach(b => b.classList.add('border', 'border-[#8E98A880]'));
        });

        function getNominalValue() {
            return parseInt(nominalInput.value.replace(/[^0-9]/g, ''), 10) || 0;
        }

        // Fungsi untuk mengisi form donatur dengan data user
        async function autofillDonaturForm() {
            const token = localStorage.getItem("token");
            if (!token) return;

            try {
                const res = await fetch("/api/dashboard", {
                    headers: { "Authorization": "Bearer " + token }
                });
                const result = await res.json();
                if (!result.data) return;

                const user = result.data;
                document.querySelector('#donatur-section input[placeholder="Nama Lengkap"]').value = user.name || '';
                document.querySelector('#donatur-section input[placeholder="0812345678910"]').value = user.whatsapp || '';
                document.querySelector('#donatur-section input[placeholder="example@gmail.com"]').value = user.email || '';
            } catch (err) {
                
            }
        }

        document.getElementById('btn-next').onclick = async function(e) {
            e.preventDefault();
            document.getElementById('detail-section').style.display = 'none';
            document.getElementById('donatur-section').style.display = '';
            document.getElementById('btn-next').style.display = 'none';
            document.getElementById('btn-donate').style.display = '';
            await autofillDonaturForm();
        };

        document.getElementById('btn-prev').onclick = function(e) {
            e.preventDefault();
            document.getElementById('detail-section').style.display = '';
            document.getElementById('donatur-section').style.display = 'none';
            document.getElementById('btn-next').style.display = '';
            document.getElementById('btn-donate').style.display = 'none';
        };

        document.getElementById('btn-donate').onclick = async function(e) {
            e.preventDefault();

            const params = new URLSearchParams(window.location.search);
            const campaignId = params.get('id');
            const token = localStorage.getItem("token");

            // Ambil nilai
            const amount = getNominalValue();
            const message = document.querySelector('#donatur-section textarea').value;

            if (!amount || amount < 10000) {
                alert("Nominal donasi minimal Rp 10.000");
                return;
            }

            try {
                const res = await fetch(`/api/donations/${campaignId}`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        ...(token && { "Authorization": "Bearer " + token })
                    },
                    body: JSON.stringify({ amount, message })
                });
                const result = await res.json();
                if (result.success) {
                    alert("Donasi berhasil! Terima kasih.");
                    window.location.href = "/dashboard";
                } else {
                    alert(result.message || "Gagal melakukan donasi");
                }
            } catch (err) {
                alert("Terjadi kesalahan saat mengirim donasi");
                console.error("Donasi error:", err);
            }
        };
    </script>

</body>

</html>